"use strict";const servers={iceServers:[{urls:"stun:stun.services.mozilla.com"},{urls:"stun:stun.l.google.com:19302"},{urls:"turn:numb.viagenie.ca",credential:"password123",username:"mikkojam@metropolia.fi"}]},$chatBox=document.querySelector(".js-chat-window"),$chatInput=document.querySelector(".js-input"),$form=document.querySelector(".js-chat-form"),caller=new RTCPeerConnection(servers),onIceCandidate=e=>{socket.emit("candidate",JSON.stringify({candidate:e.candidate}))};caller.onaddstream=(e=>{console.log("onaddstream called")}),caller.onicecandidate=(e=>{e.candidate&&(console.log("onicecandidate called"),onIceCandidate(e))});const socket=io.connect("http://localhost:3000"),makeNewCall=e=>{caller.createOffer().then(c=>{caller.setLocalDescription(new RTCSessionDescription(c)),e.emit("call",JSON.stringify(c))}).catch(e=>{console.log(e)})};$form.addEventListener("submit",e=>{e.preventDefault();const c=$chatInput.value;""!==c&&(socket.emit("message",c),$chatBox.innerHTML+='<div class="chat__row"><p class="chat__sender">User:</p><p class="chat__comment">"'+c+'"</p></div>',$chatInput.value="")},!1),socket.on("message",e=>{$chatBox.innerHTML+='<div class="chat__row"><p class="chat__sender">User:</p><p class="chat__comment">"'+e+'"</p></div>'}),socket.on("answer",e=>{caller.setRemoteDescription(new RTCSessionDescription(JSON.parse(e)))}),socket.on("call",e=>{console.log(e),socket.emit("answer","Call answered"),caller.setRemoteDescription(new RTCSessionDescription(JSON.parse(e))),caller.createAnswer().then(e=>{caller.setLocalDescription(new RTCSessionDescription(e)),socket.emit("answer",JSON.stringify(e))})}),socket.on("candidate",e=>{console.log(e),caller.addIceCandidate(new RTCIceCandidate(JSON.parse(e).candidate))});